(function($){$.jqplot.EnhancedLegendRenderer=function(){$.jqplot.TableLegendRenderer.call(this)};$.jqplot.EnhancedLegendRenderer.prototype=new $.jqplot.TableLegendRenderer;$.jqplot.EnhancedLegendRenderer.prototype.constructor=$.jqplot.EnhancedLegendRenderer;$.jqplot.EnhancedLegendRenderer.prototype.init=function(options){this.numberRows=null;this.numberColumns=null;this.seriesToggle="normal";this.seriesToggleReplot=false;this.disableIEFading=true;$.extend(true,this,options);if(this.seriesToggle){$.jqplot.postDrawHooks.push(postDraw)}};$.jqplot.EnhancedLegendRenderer.prototype.draw=function(offsets,plot){var legend=this;if(this.show){var series=this._series;var s;var ss="position:absolute;";ss+=this.background?"background:"+this.background+";":"";ss+=this.border?"border:"+this.border+";":"";ss+=this.fontSize?"font-size:"+this.fontSize+";":"";ss+=this.fontFamily?"font-family:"+this.fontFamily+";":"";ss+=this.textColor?"color:"+this.textColor+";":"";ss+=this.marginTop!=null?"margin-top:"+this.marginTop+";":"";ss+=this.marginBottom!=null?"margin-bottom:"+this.marginBottom+";":"";ss+=this.marginLeft!=null?"margin-left:"+this.marginLeft+";":"";ss+=this.marginRight!=null?"margin-right:"+this.marginRight+";":"";this._elem=$('<table class="jqplot-table-legend" style="'+ss+'"></table>');if(this.seriesToggle){this._elem.css("z-index","3")}var pad=false,reverse=false,nr,nc;if(this.numberRows){nr=this.numberRows;if(!this.numberColumns){nc=Math.ceil(series.length/nr)}else{nc=this.numberColumns}}else if(this.numberColumns){nc=this.numberColumns;nr=Math.ceil(series.length/this.numberColumns)}else{nr=series.length;nc=1}var i,j,tr,td1,td2,lt,rs,div,div0,div1;var idx=0;for(i=series.length-1;i>=0;i--){if(nc==1&&series[i]._stack||series[i].renderer.constructor==$.jqplot.BezierCurveRenderer){reverse=true}}for(i=0;i<nr;i++){tr=$(document.createElement("tr"));tr.addClass("jqplot-table-legend");if(reverse){tr.prependTo(this._elem)}else{tr.appendTo(this._elem)}for(j=0;j<nc;j++){if(idx<series.length&&(series[idx].show||series[idx].showLabel)){s=series[idx];lt=this.labels[idx]||s.label.toString();if(lt){var color=s.color;if(!reverse){if(i>0){pad=true}else{pad=false}}else{if(i==nr-1){pad=false}else{pad=true}}rs=pad?this.rowSpacing:"0";td1=$(document.createElement("td"));td1.addClass("jqplot-table-legend jqplot-table-legend-swatch");td1.css({textAlign:"center",paddingTop:rs});div0=$(document.createElement("div"));div0.addClass("jqplot-table-legend-swatch-outline");div1=$(document.createElement("div"));div1.addClass("jqplot-table-legend-swatch");div1.css({backgroundColor:color,borderColor:color});td1.append(div0.append(div1));td2=$(document.createElement("td"));td2.addClass("jqplot-table-legend jqplot-table-legend-label");td2.css("paddingTop",rs);if(this.escapeHtml){td2.text(lt)}else{td2.html(lt)}if(reverse){if(this.showLabels){td2.prependTo(tr)}if(this.showSwatches){td1.prependTo(tr)}}else{if(this.showSwatches){td1.appendTo(tr)}if(this.showLabels){td2.appendTo(tr)}}if(this.seriesToggle){var speed;if(typeof this.seriesToggle==="string"||typeof this.seriesToggle==="number"){if(!$.jqplot.use_excanvas||!this.disableIEFading){speed=this.seriesToggle}}if(this.showSwatches){td1.bind("click",{series:s,speed:speed,plot:plot,replot:this.seriesToggleReplot},handleToggle);td1.addClass("jqplot-seriesToggle")}if(this.showLabels){td2.bind("click",{series:s,speed:speed,plot:plot,replot:this.seriesToggleReplot},handleToggle);td2.addClass("jqplot-seriesToggle")}if(!s.show&&s.showLabel){td1.addClass("jqplot-series-hidden");td2.addClass("jqplot-series-hidden")}}pad=true}}idx++}td1=td2=div0=div1=null}}return this._elem};var handleToggle=function(ev){var d=ev.data,s=d.series,replot=d.replot,plot=d.plot,speed=d.speed,sidx=s.index,showing=false;if(s.canvas._elem.is(":hidden")||!s.show){showing=true}var doLegendToggle=function(){if(replot){var opts={};if($.isPlainObject(replot)){$.extend(true,opts,replot)}plot.replot(opts);if(showing&&speed){var s=plot.series[sidx];if(s.shadowCanvas._elem){s.shadowCanvas._elem.hide().fadeIn(speed)}s.canvas._elem.hide().fadeIn(speed);s.canvas._elem.nextAll(".jqplot-point-label.jqplot-series-"+s.index).hide().fadeIn(speed)}}else{var s=plot.series[sidx];if(s.canvas._elem.is(":hidden")||!s.show){if(typeof plot.options.legend.showSwatches==="undefined"||plot.options.legend.showSwatches===true){plot.legend._elem.find("td").eq(sidx*2).addClass("jqplot-series-hidden")}if(typeof plot.options.legend.showLabels==="undefined"||plot.options.legend.showLabels===true){plot.legend._elem.find("td").eq(sidx*2+1).addClass("jqplot-series-hidden")}}else{if(typeof plot.options.legend.showSwatches==="undefined"||plot.options.legend.showSwatches===true){plot.legend._elem.find("td").eq(sidx*2).removeClass("jqplot-series-hidden")}if(typeof plot.options.legend.showLabels==="undefined"||plot.options.legend.showLabels===true){plot.legend._elem.find("td").eq(sidx*2+1).removeClass("jqplot-series-hidden")}}}};s.toggleDisplay(ev,doLegendToggle)};var postDraw=function(){if(this.legend.renderer.constructor==$.jqplot.EnhancedLegendRenderer&&this.legend.seriesToggle){var e=this.legend._elem.detach();this.eventCanvas._elem.after(e)}}})(jQuery);